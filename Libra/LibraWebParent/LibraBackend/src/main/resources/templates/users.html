<!DOCTYPE html>

<!-- use thymeleaf -->
<html xmlns:th="http://www.thymeleaf.org">
<!-- use thymeleaf -->

<head th:replace="fragments :: page_head('Quản lý người dùng - Libra Admin')"/>

<body>
<div class="container-fluid">

  <!-- navigation -->
  <div th:replace="navigation :: menu"></div>

  <!-- user form -->
  <div class="text-center mt-3 mb-3">
    <h2>Quản Lý Người Dùng</h2>
  </div>

  <div th:if="${message != null}" class="alert alert-success text-center">
    [[${message}]]
  </div>

  <!-- search -->
  <div>
    <form th:action="@{/users/page/1}" class="form-inline m-3">
      <input type="hidden" name="sortField" th:value="${sortField}"/>
      <input type="hidden" name="sortType" th:value="${sortType}"/>

      Tìm Kiếm: &nbsp;
      <input type="search" name="keyword" class="form-control" required placeholder="Search"/>
      &nbsp;&nbsp;
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-search"></i>
      </button>
      &nbsp;&nbsp;
      <button type="button" class="btn btn-secondary" onclick="clearFilter()" title="Xoá">
        <i class="fas fa-eraser"></i>
      </button>
    </form>
  </div>

  <!-- table -->
  <div class="full-details">
    <table class="table table-bordered table-striped table-hover table-responsive-xl">
      <thead class="thead-dark">
      <tr>
        <th>Id</th>
        <th>Thẻ thư viện</th>
        <th>Email</th>
        <th>Tên</th>
        <th>Họ</th>
        <th>CMND</th>
        <th>SĐT</th>
        <th>Vai trò</th>
        <th>Trạng thái</th>
        <th></th>
      </tr>
      </thead>

      <!-- load user list -->
      <tbody>
      <tr th:each="user: ${listUsers}">
        <td>[[${user.id}]]</td>
        <td>[[${user.identifier}]]</td>
        <td>[[${user.email}]]</td>
        <td>[[${user.firstName}]]</td>
        <td>[[${user.lastName}]]</td>
        <td>[[${user.citizenIdentification}]]</td>
        <td>[[${user.phoneNumber}]]</td>
        <td>[[${user.role}]]</td>
        <th:block th:if="${user.role.name != 'Admin'}">
          <td>
            <a th:if="${user.enabled == true}" class="fas fa-check-circle fa-2x icon-green"
               th:href="@{'/users/' + ${user.id} + '/enabled/false'}" title="Vô hiệu hoá user"></a>
            <a th:if="${user.enabled == false}" class="fas fa-check-circle fa-2x icon-dark"
               th:href="@{'/users/' + ${user.id} + '/enabled/true'}" title="Kích hoạt user"></a>
          </td>
          <td>
            <a th:href="@{'/users/delete/' + ${user.id}}" class="fas fa-trash fa-2x icon-dark link-delete"
               th:userId="${user.id}" title="Xoá user"></a>
          </td>
        </th:block>
        <th:block th:if="${user.role.name == 'Admin'}">
          <td>
          </td>
          <td>
          </td>
        </th:block>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="less-details">
    <div th:each="user: ${listUsers}" class="row m-1">
      <div>
        <div>[[${user.fullName}]]</div>
        <div>[[${user.role}]]</div>
        <div>
          <a th:if="${user.enabled == true}" class="fas fa-check-circle fa-2x icon-green"
             th:href="@{'/users/' + ${user.id} + '/enabled/false'}" title="Vô hiệu hoá user"></a>
          <a th:if="${user.enabled == false}" class="fas fa-check-circle fa-2x icon-dark"
             th:href="@{'/users/' + ${user.id} + '/enabled/true'}" title="Kích hoạt user"></a>
          <a th:href="@{'/users/delete/' + ${user.id}}" class="fas fa-trash fa-2x icon-dark link-delete"
             th:userId="${user.id}" title="Xoá user"></a>
        </div>
      </div>
      <div>&nbsp;</div>
    </div>
  </div>

  <!-- pagination -->
  <div class="text-center m-1" th:if="${totalItems>0}">
    <span>#[[${startCount}]] đến #[[${endCount}]] của [[${totalItems}]] </span>
  </div>

  <div class="text-center m-1" th:unless="${totalItems>0}">
    <span>Không tìm thấy User</span>
  </div>

  <div th:if="${totalPages > 1}">
    <nav>
      <ul class="pagination justify-content-center flex-wrap">
        <li th:class="${currentPage > 1 ? 'page-item' : 'page-item disabled'}">
          <a th:replace="fragments :: page_link(1, 'First')"></a>
        </li>
        <li th:class="${currentPage > 1 ? 'page-item' : 'page-item disabled'}">
          <a th:replace="fragments :: page_link(${currentPage - 1}, 'Previous')"></a>
        </li>
        <li th:class="${currentPage != i ? 'page-item' : 'page-item active'}"
            th:each="i : ${#numbers.sequence(1,totalPages)}">
          <a th:replace="fragments :: page_link(${i}, ${i})"></a>
        </li>
        <li th:class="${currentPage < totalPages ? 'page-item' : 'page-item disabled'}">
          <a th:replace="fragments :: page_link(${currentPage + 1}, 'Next')"></a>
        </li>
        <li th:class="${currentPage < totalPages ? 'page-item' : 'page-item disabled'}">
          <a th:replace="fragments :: page_link(${totalPages}, 'Last')"></a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- confirm modal -->
  <div class="modal fade text-center" id="confirmModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Delete Confirmation</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <div class="modal-body">
          <span id="confirmText"></span>
        </div>

        <div class="modal-footer">
          <a class="btn btn-success" href="" id="yesButton">Yes</a>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
        </div>
      </div>
    </div>
  </div>
  <!--    confirm modal -->

  <!-- footer -->
  <div th:replace="fragments :: footer"></div>
</div>

<script type="text/javascript">

  $(document).ready(function () {
    $(".link-delete").on("click", function (e) {
      e.preventDefault(); // Prevent a link from opening the URL

      link = $(this); // object jquery, can call all jQuery methods and functions but not DOM methods.
      userId = link.attr("userId"); //  Return the value of an attribute
      userId = link.attr("userId"); //  Return the value of an attribute

      $("#yesButton").attr("href", link.attr("href")); // set value of attribute
      $("#confirmText").text("Bạn có muốn xoá user " + userId + " không ?");
      $("#confirmModal").modal();
    });
  });

  function clearFilter() {
    window.location = "[[@{/users/}]]";
  }
</script>

</body>
</html>
